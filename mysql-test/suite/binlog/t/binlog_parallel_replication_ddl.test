# Check binlog properties of various DDL:s.
# Motivated by MDEV-27365.
#
--source include/have_log_bin.inc
--source include/have_binlog_format_mixed.inc

RESET MASTER;

CREATE TABLE t1 (a INT);

# MDEV-27365 CREATE-or-REPLACE bilogged without DDL flag
# Prove the following DDL:s are logged with the flag.
CREATE OR REPLACE TABLE t1 (b INT);
CREATE OR REPLACE SEQUENCE s1;

# This one has been always correct.
DROP SEQUENCE s1;
FLUSH LOGS;

--let $MYSQLD_DATADIR= `select @@datadir`

--replace_regex /TIMESTAMP=[0-9]*/TIMESTAMP=XXX/ /# at [0-9]*/# at #/ /(exec_time=|end_log_pos |Xid = |thread_id=|server id |table id |mapped to number )[0-9]+/\1#/  /server v [^ ]*/server v #.##.##/  /CRC32 0x[0-9a-f]*/CRC32 XXX/ /GTID [0-9]+-[0-9]+-[0-9]+/GTID #-#-#/ /Gtid list [[][0-9]+-[0-9]+-[0-9]+[\]]/Gtid list [#-#-#]/ /session[.](gtid_domain_id|server_id|gtid_seq_no)=[0-9]+/session.\1=#/ /(^#|created )[0-9]{6} [ 12][0-9]:[0-9]{2}:[0-9]{2}/\1YYMMDD HH:MM:SS/ /collation_server=[0-9]+/collation_server=X/ /character_set_client=[0-9]+/character_set_client=X/ /collation_connection=[0-9]+/collation_connection=X/ /xid=\d*/xid=<xid>/

--exec $MYSQL_BINLOG --base64-output=decode-rows $MYSQLD_DATADIR/master-bin.000001 

DROP TABLE t1;

--echo End of the tests
